# 电影院购票系统详细介绍文档

## 一、项目概述

### 1.1 项目背景
随着数字化时代的到来，传统的电影院售票方式已经无法满足现代用户的需求。本项目基于若依框架开发了一套完整的电影院购票管理系统，旨在提供便捷、高效的电影票务服务。

### 1.2 系统特色
- **多端适配**: 支持Web管理端和微信小程序端
- **功能完整**: 涵盖电影管理、票务销售、用户服务等全业务流程
- **技术先进**: 采用主流技术栈，架构清晰，易于维护和扩展
- **用户友好**: 界面简洁美观，操作流畅便捷

## 二、技术架构详解

### 2.1 整体架构图

```
┌─────────────────┐    ┌─────────────────┐
│   微信小程序端   │    │   Web管理端     │
│    (film-wx)    │    │   (film-ui)     │
└─────────┬───────┘    └─────────┬───────┘
          │                      │
          └──────────┬───────────┘
                     │ HTTP/HTTPS
         ┌───────────▼────────────┐
         │     Spring Boot        │
         │      后端服务          │
         └───────────┬────────────┘
                     │
         ┌───────────▼────────────┐
         │      MySQL数据库       │
         │      Redis缓存         │
         └────────────────────────┘
```

### 2.2 技术栈详情

#### 后端技术
| 技术组件 | 版本 | 用途描述 |
|---------|------|----------|
| Spring Boot | 2.5.14 | 应用框架核心 |
| Spring Security | - | 安全认证框架 |
| MyBatis | - | ORM持久层框架 |
| PageHelper | 1.4.6 | 分页插件 |
| Druid | 1.2.15 | 数据库连接池 |
| Fastjson2 | 2.0.20 | JSON处理 |
| JWT | 0.9.1 | Token认证 |
| Swagger3 | 3.0.0 | API文档 |
| Quartz | - | 定时任务调度 |
| Velocity | 2.3 | 模板引擎 |

#### 前端技术
| 技术组件 | 版本 | 用途描述 |
|---------|------|----------|
| Vue.js | 2.6.12 | 前端框架 |
| Element UI | 2.15.10 | UI组件库 |
| ECharts | 5.4.0 | 图表库 |
| Axios | 0.24.0 | HTTP客户端 |
| Vuex | 3.6.0 | 状态管理 |
| Vue Router | 3.4.9 | 路由管理 |

## 三、功能模块详细说明

### 3.1 电影管理模块

#### 3.1.1 电影基础信息
- **字段说明**:
  - 中文名称/英文名称
  - 电影类型（动作、喜剧、科幻等）
  - 导演信息
  - 主演阵容
  - 版本信息（2D/3D/IMAX）
  
#### 3.1.2 多媒体资源
- 电影海报图片
- 宣传图片
- 预告片链接
- 剧照集合

#### 3.1.3 排期管理
- 放映时间设置
- 影厅分配
- 票价配置
- 座位布局管理

### 3.2 票务系统模块

#### 3.2.1 在线选座
```javascript
// 座位状态枚举
const SeatStatus = {
  AVAILABLE: 0,    // 可选
  SELECTED: 1,     // 已选中
  SOLD: 2,         // 已售出
  MAINTENANCE: 3   // 维护中
}
```

#### 3.2.2 订单流程
1. **选择电影** → 浏览电影列表，查看详情
2. **选择场次** → 查看排期，选择时间和影厅
3. **选择座位** → 可视化选座界面
4. **确认订单** → 核对信息，选择支付方式
5. **支付完成** → 生成电子票据
6. **入场验证** → 扫码验票

#### 3.2.3 支付集成
- 支持多种支付方式
- 订单状态实时同步
- 退款处理机制

### 3.3 用户管理模块

#### 3.3.1 用户注册登录
- 手机号注册
- 微信一键登录
- JWT Token认证
- 用户信息完善

#### 3.3.2 会员体系
```sql
-- 会员等级表结构
CREATE TABLE `member_level` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `level_name` varchar(50) COMMENT '等级名称',
  `min_points` int(11) COMMENT '最低积分',
  `discount_rate` decimal(3,2) COMMENT '折扣率',
  PRIMARY KEY (`id`)
);
```

### 3.4 评论系统模块

#### 3.4.1 评分机制
- 10分制评分系统
- 评分统计和平均值计算
- 评分趋势分析

#### 3.4.2 评论管理
- 文本内容审核
- 敏感词过滤
- 评论点赞功能
- 管理员审核

### 3.5 健康码管理模块

#### 3.5.1 健康状态记录
```sql
-- 健康码表结构
CREATE TABLE `f_healthy` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `user_name` varchar(255) COMMENT '用户名',
  `temperature` decimal(4,1) COMMENT '体温',
  `health_status` varchar(20) COMMENT '健康状态',
  `travel_history` text COMMENT '出行记录',
  `create_time` datetime COMMENT '创建时间',
  PRIMARY KEY (`id`)
);
```

### 3.6 数据分析模块

#### 3.6.1 票房统计
- 日/周/月票房统计
- 电影票房排行
- 影厅利用率分析
- 收入趋势图表

#### 3.6.2 用户行为分析
- 用户活跃度统计
- 观影偏好分析
- 消费能力评估
- 用户留存率

## 四、数据库设计

### 4.1 核心表结构

#### 电影表 (f_film)
```sql
CREATE TABLE `f_film` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COMMENT '电影名称',
  `e_name` varchar(255) COMMENT '英文名称',
  `type` varchar(255) COMMENT '类型',
  `director` varchar(255) COMMENT '导演',
  `star` varchar(255) COMMENT '主演',
  `version` varchar(255) COMMENT '版本',
  `describe` varchar(3000) COMMENT '剧情描述',
  `score` double COMMENT '评分',
  `p_number` int(11) COMMENT '想看人数',
  -- 更多字段...
  PRIMARY KEY (`id`)
);
```

#### 订单表 (f_order)
```sql
CREATE TABLE `f_order` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `user_name` varchar(255) COMMENT '用户名',
  `film_id` bigint(20) COMMENT '电影ID',
  `seat_number` varchar(255) COMMENT '座位号',
  `order_status` varchar(50) COMMENT '订单状态',
  `total_price` decimal(10,2) COMMENT '总价',
  `create_time` datetime COMMENT '创建时间',
  PRIMARY KEY (`id`)
);
```

### 4.2 数据库优化策略

#### 4.2.1 索引设计
```sql
-- 电影查询优化
CREATE INDEX idx_film_type ON f_film(type);
CREATE INDEX idx_film_score ON f_film(score);

-- 订单查询优化
CREATE INDEX idx_order_user ON f_order(user_name);
CREATE INDEX idx_order_film ON f_order(film_id);
CREATE INDEX idx_order_time ON f_order(create_time);
```

#### 4.2.2 分页查询
```xml
<!-- MyBatis分页查询示例 -->
<select id="selectFilmList" resultType="Film">
  SELECT * FROM f_film 
  WHERE type = #{type}
  ORDER BY score DESC, create_time DESC
</select>
```

## 五、微信小程序开发指南

### 5.1 项目结构
```
film-wx/
├── pages/              # 页面目录
│   ├── index/         # 首页
│   ├── film/          # 电影列表
│   ├── details/       # 电影详情
│   ├── seat/          # 选座页面
│   ├── order/         # 订单页面
│   └── my/            # 个人中心
├── components/         # 组件目录
├── utils/             # 工具函数
├── static/            # 静态资源
└── app.js             # 小程序入口
```

### 5.2 关键配置

#### app.json配置
```json
{
  "pages": [
    "pages/login/login",
    "pages/index/index",
    "pages/film/film",
    "pages/details/details",
    "pages/seat/seat",
    "pages/order/order",
    "pages/my/my"
  ],
  "tabBar": {
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "首页",
        "iconPath": "/static/images/tabBar/video.png"
      }
    ]
  }
}
```

### 5.3 API接口调用
```javascript
// utils/api.js
const request = (url, method = 'GET', data = {}) => {
  return new Promise((resolve, reject) => {
    wx.request({
      url: `${config.baseUrl}${url}`,
      method: method,
      data: data,
      header: {
        'Content-Type': 'application/json',
        'Authorization': wx.getStorageSync('token')
      },
      success: resolve,
      fail: reject
    })
  })
}
```

## 六、部署运维指南

### 6.1 开发环境搭建

#### 环境准备
```bash
# 安装Java环境
sudo apt-get install openjdk-8-jdk

# 安装Maven
sudo apt-get install maven

# 安装Node.js
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.0/install.sh | bash
nvm install 14.17.0

# 安装MySQL
sudo apt-get install mysql-server
```

#### 项目配置
```yaml
# application-dev.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/movie?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    
  redis:
    host: localhost
    port: 6379
    timeout: 10000ms
```

### 6.2 生产环境部署

#### Docker部署方案
```dockerfile
# Dockerfile
FROM openjdk:8-jre-alpine

WORKDIR /app
COPY admin/target/admin.jar app.jar

EXPOSE 8080
CMD ["java", "-jar", "app.jar"]
```

#### docker-compose.yml
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
      
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_DATABASE: movie
    volumes:
      - ./sql:/docker-entrypoint-initdb.d
      
  redis:
    image: redis:6.2-alpine
```

### 6.3 性能优化

#### 6.3.1 数据库优化
- 合理设计索引
- 使用连接池
- 读写分离配置
- 定期数据清理

#### 6.3.2 缓存策略
```java
@Service
public class FilmService {
    
    @Cacheable(value = "films", key = "#type")
    public List<Film> getFilmsByType(String type) {
        return filmMapper.selectByType(type);
    }
    
    @CacheEvict(value = "films", allEntries = true)
    public void updateFilm(Film film) {
        filmMapper.updateById(film);
    }
}
```

### 6.4 监控告警

#### 应用监控
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
```

## 七、常见问题解答

### Q1: 如何处理高并发抢票场景？
**A**: 
1. 使用Redis分布式锁
2. 数据库乐观锁机制
3. 限流和排队策略
4. 缓存热点数据

### Q2: 微信小程序如何实现支付功能？
**A**: 
1. 集成微信支付SDK
2. 后端生成预支付订单
3. 小程序调用支付接口
4. 处理支付回调

### Q3: 如何保证数据安全？
**A**: 
1. 数据库加密存储
2. API接口鉴权
3. 敏感信息脱敏
4. 定期安全审计

### Q4: 系统如何扩展支持多影院？
**A**: 
1. 增加影院管理模块
2. 修改数据库表结构
3. 调整业务逻辑
4. 更新前端界面

## 八、版本更新计划

### 近期规划 (v3.9.0)
- [ ] 增加在线支付功能
- [ ] 优化选座体验
- [ ] 新增会员积分系统
- [ ] 完善数据统计功能

### 长期规划 (v4.0.0)
- [ ] 支持多影院管理
- [ ] 引入AI推荐系统  
- [ ] 开发移动端APP
- [ ] 集成第三方票务平台

---

**本文档持续更新中，如有疑问请联系开发团队。**
